\chapter{MGXS Generation with Monte Carlo}
\label{chap:mgxs-mc}

In the preceding chapter it was observed that many approximations are made in multi-group theory and the generation of multi-group cross sections. Monte Carlo is an approach to replace some of the steps in the standard multi-level framework for \ac{MGXS} generation with a natural and reactor agnostic treatment of energy and spatial self-shielding. This chapter presents a brief overview of \ac{MC} tallies and statistics in Sec.~\ref{sec:chap3-mc-overview}, and Sec.~\ref{sec:chap3-mgxs-gen} outlines the necessary computation needed to generate \ac{MGXS} with \ac{MC}. Sec.~\ref{sec:chap3-lit-review} discusses past work to apply \ac{MC} for \ac{MGXS} generation, while Sec.~\ref{sec:chap3-latent-variables} introduces a new approach based on a latent variable model for spatial self-shielding.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Overview of Monte Carlo Methods}
\label{sec:chap3-mc-overview}

Monte Carlo methods have been successfully applied to neutron transport calculations for many decades. A detailed accounting of the physics models and algorithms used in \ac{MC} methods can be found in the manuals for the MCNP~\cite{mcnpx2003manual}, Serpent~\cite{serpent2013manual} and OpenMC~\cite{openmc2016manual} Monte Carlo particle transport codes. This section presents a few key aspects related to tallies and statistics, and follows directly from the manual for the OpenMC~\cite{openmc2016manual} code which is used throughout this work.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Monte Carlo Tallies}
\label{subsec:chap3-mc-tallies}

\ac{MC} simulations sample the particle distribution in order to compute integral quantities of interest called \textit{tallies}. A tally is an integral of a \textit{scoring function} $f$ weighted by the neutron distribution, or flux, across some region of phase space. A general form for tally $\mathcal{T}$ is given by the following integral expression:

\begin{dmath}
\label{eqn:chap3-tallies-general}
\mathcal{T} = \int_{V} \int_{S} \int_{E}  f(\mathbf{r},\mathbf{\Omega},E)\psi(\mathbf{r},\mathbf{\Omega},E)\mathrm{d}E\mathrm{d}\mathbf{\Omega}\mathrm{d}\mathbf{r} 
\end{dmath}

In OpenMC parlance, the integration bounds over space, angle and energy are termed \textit{filters}, while the scoring function $f$ is simply known as a \textit{score}. Various scores may be used to compute volume-integrated fluxes, reaction rates, functional expansions and more. \ac{MC} does not perform the integration in Eqn.~\ref{eqn:chap3-tallies-general} with the exact flux specified at all points in phase space. Instead, \ac{MC} performs stochastic integration by sampling the particle population across the entirety of phase space to compute a \textit{statistical estimate} $\hat{\mathcal{T}}$ of the true integral $\mathcal{T}$.

There are a number of different techniques to estimate a tally. The first and most general method is known as an \textit{analog estimator}. An analog estimator $\hat{\mathcal{T}}$ increments a tally by the particle weight $w_{i}$ each time an event $i$ occurs from the set of all events of interest $A$ (\textit{e.g.}, fission events). The sum of particle weights is then normalized by the total weight of all particles $W$ to compute the interaction frequency on a per-particle basis within the phase space volume of interest:

\begin{dmath}
\label{eqn:chap3-tallies-analog}
\hat{\mathcal{T}} = \frac{1}{W}\displaystyle\sum\limits_{i \in A} w_{i}
\end{dmath}

Although analog estimators permit general filters and scoring functions, they may suffer from poor tallying efficiency if the size of set $A$ is very small compared to the total number of events in a simulation. A \textit{collision estimator} improves the tallying efficiency by incrementing a tally more frequently than is possible with analog estimators. In particular, a collision estimator increments a tally at each collision $i$ from the set of all collisions $C$ irregardless of the types of collisions that took place. By noting that the total collision rate is given by $R_{t} = \Sigma_{t}\phi$, a collision estimator for the flux $\hat{\phi}$ may be simply defined by dividing the particle weights by the total macroscopic cross section:

\begin{dmath}
\label{eqn:chap3-tallies-collision-flux}
\hat{\phi} = \frac{1}{W}\displaystyle\sum\limits_{i \in C}\frac{w_{i}}{\Sigma_{t}(E_{i})}
\end{dmath}

\noindent The collision estimator depends on the energy of the incoming particle $E_{i}$ in order to scale the particle weight by the energy-dependent total cross section. It follows that the collision estimator for a reaction rate $\hat{\mathcal{R}}_{x}$ is the product of the flux in Eqn.~\ref{eqn:chap3-tallies-collision-flux} and the cross section for the reaction type $x$ of interest:

\begin{dmath}
\label{eqn:chap3-tallies-collision-rxn}
\hat{\mathcal{R}}_{x} = \frac{1}{W}\displaystyle\sum\limits_{i \in C}\frac{w_{i}\Sigma_{x}(E_{i})}{\Sigma_{t}(E_{i})}
\end{dmath}

The collision estimator increases the number of events in $C$ to improve the tallying efficiency with respect to analog tallies. A third known as \textit{track-length estimators} goes one step further and increments a tally each time a particle trajectory crosses the phase space of interest (\textit{e.g.}, a spatial tally mesh zone) even if a collision did not take place. The track-length estimator makes use of a particle's distance travelled $\Delta\mathbf{r}$ to estimate the flux. A track-length estimator of the flux is therefore:

\begin{dmath}
\label{eqn:chap3-tallies-tracklength-flux}
  \hat{\phi} = \frac{1}{W}\displaystyle\sum\limits_{i \in T}w_{i}\Delta\mathbf{r}_{i}
\end{dmath}

\noindent where the set $T$ represents each particle trajectory through the phase space volume of interest. Similarly, a track-length estimate of a reaction rate $x$ can be found from simply multiplying the flux in Eqn.~\ref{eqn:chap3-tallies-tracklength-flux} by the cross section:

\begin{dmath}
\label{eqn:chap3-tallies-tracklength-rxn}
  \hat{\mathcal{R}}_{x} = \frac{1}{W}\displaystyle\sum\limits_{i \in T}w_{i}\Delta\mathbf{r}_{i}\Sigma_{x}(E_{i})
\end{dmath}

The tallying efficiency for track-length estimators is greatly improved by incrementing a tally for each particle trajectory. As a result, the confidence intervals are generally much tighter for track-length estimators than those for analog and collision estimators. 

Each of the three estimators -- analog, collision and track-length -- may be useful for different scenarios. Although track-length and collision estimators improve statistics over analog estimates, they cannot be employed for all types of filters. For example, track-length tallies may not be used if the scoring function requires information about the outgoing particle since this is not available unless a collision took place. As discussed in Sec.~\ref{sec:chap3-mgxs-gen}, a mixture of estimators which tradeoff generality with efficiency must be used to generate \ac{MGXS} from \ac{MC} tallies.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Sample Statistics}
\label{subsec:chap3-mc-stats}

As discussed in the preceding section, \ac{MC} performs stochastic integration with one of a number of different estimators. In each case, the tally estimator $\hat{\mathcal{T}}$ is computed as a sample mean of of all of the events or particle trajectories simulated. An unbiased estimate of the sample mean is given by:

\begin{equation}
\label{eqn:chap3-sample-mean}
\bar{x} = \frac{1}{N} \displaystyle\sum\limits_{i=1}^{N} x_{i}
\end{equation}

\noindent where each of the $N$ samples is given by a random variable $x_{i}$. For \ac{MC} codes that used batch-based statistics, such as OpenMC, $N$ is the number of batches of particles simulated and $x_{i}$ is the tally estimator for the $i$\textsuperscript{th} batch of particles. 

Each of the random variables $x_{i}$ is sampled from some probability distribution representative of the physics in the simulation. The sampling distribution is normal and $x_{i} \sim \mathcal{N}(\mu,\sigma^{2})$ where $\mathcal{N}(\mu,\sigma^{2})$ signifies a normal distribution with mean $\mu$ and variance $\sigma^{2}$ if each batch of particles is independent. An unbiased estimate of the variance $\sigma^{2}$ of the distribution from which the population $x_{i}$ is drawn may be estimated using Bessel's correction for the sample variance $s^{2}$:

\begin{equation}
\label{eqn:chap3-variance-sample}
s^{2} = \frac{1}{N-1}\displaystyle\sum\limits_{i=1}^{N}\left(x_{i} - \bar{x}\right)^{2}
\end{equation}

\noindent As $N \rightarrow \infty$ the population variance estimator will approach the true variance $\sigma^{2}$ of the underlying distribution. In the case of batch-based statistics, the variance $\sigma^{2}$ will be determined by the number of particles simulated per batch -- the more particle histories simulated per batch, the smaller $\sigma^{2}$ will be, and vice versa.

In general, it is more useful to quantify the uncertainty of a tally estimator than it is to compute the sample variance. The variance of the sample mean is representative of the distribution from which the random variable $\bar{x}$ is drawn and indicates the degree of confidence one may have in a tally estimator. By the Central Limit Theorem, the sample mean $\bar{x}$ will converge to the mean of a normal distribution if the samples $x_{i}$ are uncorrelated. An unbiased estimate of the variance of the sample mean can be derived from the Bienaym\'{e} formula to give:

\begin{equation}
\label{eqn:chap3-variance-mean}
s_{\bar{x}}^{2} = \frac{1}{N-1}\left(\frac{1}{N}\displaystyle\sum\limits_{i=1}^{N}
x_{i}^{2} - \bar{x}^2\right)
\end{equation}

The key observation is that the standard deviation of the sample mean varies as $s_{\bar{x}} \propto \nicefrac{1}{\sqrt{N}}$ if the samples $x_{i}$ are uncorrelated. This necessarily implies that the uncertainties on a tally estimator can be made arbitrarily small given enough simulated particle histories. However, recent studies have shown that batch-based tally estimators in eigenvalue calculations are not generally independent and identically distributed realizations due to correlated fission sources between batches~\cite{herman2014correlation,miao2016correlation}. 


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{MGXS Generation with Monte Carlo}
\label{sec:chap3-mgxs-gen}

This section describes how multi-group cross sections may be computed using stochastic integration. Sec.~\ref{subsec:chap3-tally-types} outlines the types of OpenMC tallies needed to generate \ac{MGXS} for -- including the scores, filters and estimators for each tally -- and the arithmetic combinations used to combine different tallies. Sec.~\ref{subsec:chap3-uncertainty-prop} illustrates how the uncertainties of the \ac{MGXS} may be estimated using error propagation theory.


%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Tally Types Needed for \ac{MGXS} Libraries}
\label{subsec:chap3-tally-types}

The types of \ac{MGXS} needed to solve the neutron transport equation were outlined in Chap.~\ref{chap:mgxs}, including expressions for the transport corrected total cross section and scattering matrix, and the fission production cross section and spectrum. This section outlines the types of tallies needed to compute these \ac{MGXS}. It is important to note that the flux separability approximation (Sec.~\ref{subsec:chap2-angle}) is applied in the tally formulations for each of the group constants.

\subsubsection{Inner Product Notation}
\label{subsec:chap3-tally-types-notation}

The following sections use angle bracket notation $\langle \cdot , \cdot \rangle$ to represent inner products in phase space. This may correspond to integrals over incoming and/or outgoing energy, space, and angle. Using this notation, a tally estimator for reaction rate $x$ is represented as follows: 

\begin{equation}
\label{eqn:chap3-inner-prod-notation}
\langle \Sigma_x, \psi \rangle = \int_{V} \int_{S} \int_{E} \Sigma_{x}(\mathbf{r},E)\psi(\mathbf{r},E,\mathbf{\Omega}) \mathrm{d}E\mathrm{d}\mathbf{\Omega}\mathrm{d}\mathbf{r}
\end{equation}

\noindent This notation is specialized throughout this section with subscripts to indicate the subsets of phase space that are integrated over in the inner product. In particular, subscript $k$ refers to a volume integral over $V_{k}$ for some region of space $k$ for spatial homogenization (Sec.~\ref{subsec:chap2-space}), while subscript $g$ corresponds to an integral over energies with $E \in [E_{g}, E_{g-1}]$ for energy condensation (Sec.~\ref{subsec:chap2-energy}). For example, the microscopic reaction rate for reaction $x$ by nuclide $i$ is denoted as:

\begin{equation}
\label{eqn:chap3-angle-rxn-rate}
\langle \sigma_{x,i}, \psi \rangle_{k,g} = \int_{\mathbf{r} \in V_{k}} \int_{4\pi} \int_{E_{g}}^{E_{g-1}} \sigma_{x,i}(\mathbf{r},E)\psi(\mathbf{r},E,\mathbf{\Omega}) \mathrm{d}E\mathrm{d}\mathbf{\Omega}\mathrm{d}\mathbf{r}
\end{equation}

\noindent The inner product of a function with unity, such as the spatially homogenized and energy-integrated flux is denoted by:

\begin{equation}
\label{eqn:chap3-angle-flux}
\langle \psi \rangle_{k,g} \equiv \langle \psi, \mathbb{1} \rangle_{k,g} = \int_{\mathbf{r} \in V_{k}} \int_{4\pi} \int_{E_{g}}^{E_{g-1}} \psi(\mathbf{r},E,\mathbf{\Omega}) \mathrm{d}E\mathrm{d}\mathbf{\Omega}\mathrm{d}\mathbf{r}
\end{equation}

Finally, the superscripts $a$ and $t\ell$ are given to those inner products computed with analog and track-length estimators, respectively -- \textit{i.e.}, $\langle \cdot,\cdot \rangle^{a}$ is an analog tally estimator and $\langle \cdot,\cdot \rangle^{t\ell}$ is a track-length tally estimator of the corresponding inner products.


\subsubsection{General Reaction Cross Section}
\label{subsubsec:chap3-gen-xs}

A general spatially homogenized and energy condensed macroscopic multi-group cross section for reaction $x$, spatial zone $k$, energy group $g$ can be computed with track-length tally estimators in OpenMC. The \ac{MGXS} is simply the ratio of the group-wise reaction rates $\langle \Sigma_{x}, \psi \rangle_{k,g}^{t\ell}$ and fluxes $\langle \Sigma_{x}, \psi \rangle_{k,g}^{t\ell}$:

\begin{equation}
\label{eqn:chap3-general-macro}
\hat{\Sigma}_{x,k,g} = \frac{\langle \Sigma_{x}, \psi \rangle_{k,g}^{t\ell}}{\langle \psi \rangle_{k,g}^{t\ell}}
\end{equation}

\noindent Likewise, a microscopic \ac{MGXS} for nuclide $i$ can be computed as follows:

\begin{equation}
\label{eqn:chap3-general-micro}
\hat{\sigma}_{x,i,k,g} = \frac{\langle \sigma_{x,i}, \psi \rangle_{k,g}^{t\ell}}{\langle \psi \rangle_{k,g}^{t\ell}}
\end{equation}

These estimators are used for reaction types which are only dependent on the incoming energy of a neutron, such as total and radiative capture reactions.


\subsubsection{Total Cross Section}
\label{subsubsec:chap3-tally-types-tot-xs}

The total macroscopic cross section $\Sigma_{t}$ is a special case of Eqn.~\ref{eqn:chap3-general-micro}, with track-length estimators for the total collision rate and flux:

\begin{equation}
\label{eqn:chap3-total-macro}
\hat{\Sigma}_{t,k,g} = \frac{\langle \Sigma_{t}, \psi \rangle_{k,g}^{t\ell}}{\langle \psi \rangle_{k,g}^{t\ell}}
\end{equation}

As discussed in Sec.~\ref{subsec:chap2-transport-corr}, a transport correction is often used to incorporate anisotropic scattering effects into the transport equation with an isotropic scattering kernel. An expression for the in-scatter approximation~\cite{yamamoto2008simplified} to the transport correction can be computed with an OpenMC tally for the first Legendre scattering moment\footnote{It is assumed that scattering multiplicity is included in the scattering moments as discussed in Sec.~\ref{sec:chap2-scatt-prod}.}. The inner product for this tally is given by:

\begin{equation}
\label{eqn:chap3-sigs1}
\langle \Sigma_{s1}, \psi \rangle_{k,g'\rightarrow g} = \int_{\mathbf{r} \in V_{k}} \int_{4\pi} \int_{E_{g}}^{E_{g-1}} \int_{E_{g'}}^{E_{g'-1}} \Sigma_{s1}(\mathbf{r},E'\rightarrow E)\psi(\mathbf{r},E',\mathbf{\Omega}) \mathrm{d}E'\mathrm{d}E\mathrm{d}\mathbf{\Omega}\mathrm{d}\mathbf{r}
\end{equation}

\noindent An analog estimator must be used in OpenMC since the tally includes an integral over the outgoing neutron energy. The spatially homogenized and energy condensed transport corrected total cross section given in Eqn.~\ref{eqn:chap2-transport-xs} is computed by summing over all incoming energy groups:

\begin{equation}
\label{eqn:chap3-transport-corr-macro}
\Delta\hat{\Sigma}_{tr,k,g} = \displaystyle\sum\limits_{g'=1}^{G} \langle{\Sigma_{s1}, \psi \rangle_{k,g'\rightarrow g}^{a}}
\end{equation}

\noindent The transport correction is then subtracted from the group-wise total collision rate and normalized by the flux to compute the transport-corrected total cross section:

\begin{equation}
\label{eqn:chap3-sigt-transport-macro}
\hat{\tilde{\Sigma}}_{t,k,g} = \frac{\langle \Sigma_{t}, \psi \rangle_{k,g}^{a} - \Delta\hat{\Sigma}_{tr,k,g}}{\langle \psi \rangle_{k,g}^{a}}
\end{equation}

\noindent Note that since the transport correction must be computed using an analog estimator, the total collision and flux in Eqn.~\ref{eqn:chap3-sigt-transport-macro} must also be computed with analog estimators.


\subsubsection{Scattering Matrix}
\label{subsubsec:chap3-tally-types-scatt-mat}

The isotropic scattering matrix is computed with an inner product of scattering reactions over both incoming and outgoing energies. An analog estimator must be used since the integral is dependent on the neutron's outgoing energy. Similar to the first Legendre moment in Eqn.~\ref{eqn:chap3-sigs1}, the isotropic scattering moment is given by the following expression:

\begin{equation}
\label{eqn:chap3-sigs0}
\langle \Sigma_{s0}, \psi \rangle_{k,g'\rightarrow g} = \int_{\mathbf{r} \in V_{k}} \int_{4\pi} \int_{E_{g}}^{E_{g-1}} \int_{E_{g'}}^{E_{g'-1}} \Sigma_{s0}(\mathbf{r},E'\rightarrow E)\psi(\mathbf{r},E,\mathbf{\Omega}) \mathrm{d}E'\mathrm{d}E\mathrm{d}\mathbf{\Omega}\mathrm{d}\mathbf{r}
\end{equation}

\noindent The isotropic scattering matrix is then:

\begin{equation}
\label{eqn:chap3-scatter-macro}
\hat{\Sigma}_{s,k,g} = \frac{\langle \Sigma_{s0}, \psi \rangle_{k,g'\rightarrow g}^{a}}{\langle \psi \rangle_{k,g'}^{a}}
\end{equation}

\noindent The transport correction in Eqn.~\ref{eqn:chap3-transport-corr-macro} can be applied by subtracting it off the diagonal elements in the matrix to compute the transport-corrected scattering matrix:

\begin{equation}
\label{eqn:chap3-scatter-trans-macro}
\hat{\tilde{\Sigma}}_{s,k,g'\rightarrow g} = \frac{\langle \Sigma_{s0}, \psi \rangle_{k,g'\rightarrow g}^{a} - \delta_{g,g'} \Delta\hat{\Sigma}_{tr,k,g}}{\langle \psi \rangle_{k,g'}^{a}}
\end{equation}

%\begin{equation}
%\label{eqn:chap3-scatter-trans-macro}
%\hat{\tilde{\Sigma}}_{s,k,g'\rightarrow g} = \frac{\langle \Sigma_{s0}, \psi \rangle_{k,g'\rightarrow g}^{a} - \delta_{g,g'} \displaystyle\sum\limits_{g''=1}^{G} \langle{\Sigma_{s1}, \psi \rangle_{k,g''\rightarrow g}^{a}}}{\langle \psi \rangle_{k,g'}^{a}}
%\end{equation}


\subsubsection{Fission Production Cross Section}
\label{subsubsec:chap3-tally-types-fiss-prod}

The fission production cross section was condensed in Eqn.~\ref{eqn:chap2-nusifg} to make it independent of the energies of the neutrons emitted from fission. It is therefore straightforward to treat the fission product macroscopic cross section $\nu\Sigma_{f}$ as a special case of Eqn.~\ref{eqn:chap3-general-micro}, with track-length estimators for the total collision rate and flux:

\begin{equation}
\label{eqn:chap3-nu-fiss-macro}
\nu\hat{\Sigma}_{f,k,g} = \frac{\langle \nu\Sigma_{f}, \psi \rangle_{k,g}^{t\ell}}{\langle \psi \rangle_{k,g}^{t\ell}}
\end{equation}


\subsubsection{Fission Energy Spectrum}
\label{subsubsec:chap3-tally-types-chi}

Unlike the fission production cross section, the fission spectrum is dependent on the outgoing neutron energy and must be computed with analog estimators. The fission production matrix from group $g$ into group $g'$ is given by the following inner product:

\begin{equation}
\label{eqn:chap3-nu-fiss-energies}
\langle \nu\Sigma_{f}, \psi \rangle_{k,g'\rightarrow g} = \int_{\mathbf{r} \in V_{k}} \int_{4\pi} \int_{E_{g}}^{E_{g-1}} \int_{E_{g'}}^{E_{g'-1}} \nu\Sigma_{f}(\mathbf{r},E'\rightarrow E)\psi(\mathbf{r},E,\mathbf{\Omega}) \mathrm{d}E'\mathrm{d}E\mathrm{d}\mathbf{\Omega}\mathrm{d}\mathbf{r}
\end{equation}

\noindent The fission spectrum in Eqn.~\ref{eqn:chap2-nusifg} can then be computed from this tally by summing over incoming and outgoing energy groups:

\begin{equation}
\label{eqn:chap3-nu-fiss-macro}
\hat{\chi}_{k,g} = \frac{\displaystyle\sum\limits_{g'=1}^{G} \langle \nu\Sigma_{f}, \psi \rangle_{k,g'\rightarrow g}^{a}}{\displaystyle\sum\limits_{g=1}^{G} \displaystyle\sum\limits_{g'=1}^{G} \langle \nu\Sigma_{f}, \psi \rangle_{k,g'\rightarrow g}^{a}}
\end{equation}

\noindent This expression for the fission spectrum will result in a normalized discrete probability distribution for the energy of neutrons emitted from fission.


\subsubsection{Summary}
\label{subsubsec:chap3-tally-types-summary}

The tallies needed to generate \ac{MGXS} libraries were outlined in detail in the preceding sections, and are summarized in Table~\ref{table:chap3-tally-types}. The scores and filters correspond to the notation used by the OpenMC code to describe the scoring function and integration bounds used in Eqn.~\ref{eqn:chap3-tallies-general}. 
The energy group structure for energy condensation is specified by \texttt{energy} and/or \texttt{energyout} filters in the table. The regions for spatial homogenization are specified by \texttt{material} or \texttt{cell} filters, although this could potentially include \texttt{universe}, \texttt{distribcell} and \texttt{mesh} filters as well.

%\renewcommand{\arraystretch}{1.5}

\begin{table}[h!]
  \centering
  \caption[Tally types for \ac{MGXS} generation]{The types of tallies used in \ac{MGXS} generation with OpenMC.}
  \scriptsize
  \label{table:chap3-tally-types}
  \vspace{6pt}
  \begin{tabular}{ m{1.3cm} m{1cm} m{2cm} m{2.5cm} m{2.5cm} m{1.5cm} }
  \toprule
  {\bf Name} &
  {\bf Symbol} &
  {\bf Tally} &
  {\bf Score} &
  {\bf Filters} &
  {\bf Estimator} \\

  \specialrule{.2em}{.1em}{.1em}

  \multirow{2}{*}[-0.7em]{\bf General} & \multirow{2}{*}[-0.7em]{$\hat{\Sigma}_{x,k,g}$} & $\langle \Sigma_{x}, \psi \rangle_{k,g}$ & reaction $x$ & \parbox{2cm}{\texttt{material}/\texttt{cell} \texttt{energy}} & \texttt{tracklength} \\
  \cline{3-6}
  & & $\langle \psi \rangle_{k,g}$ & {\texttt{flux}} & \parbox{2cm}{\texttt{material}/\texttt{cell} \texttt{energy}} & \texttt{tracklength} \\

  \specialrule{.2em}{.1em}{.1em}

  \multirow{2}{*}[-0.7em]{\bf Total} & \multirow{2}{*}[-0.7em]{$\hat{\Sigma}_{t,k,g}$} & $\langle \Sigma_{t}, \psi \rangle_{k,g}$ & \texttt{total} & \parbox{2cm}{\texttt{material}/\texttt{cell} \texttt{energy}} & \texttt{tracklength} \\
  \cline{3-6}
  & & $\langle \psi \rangle_{k,g}$ & \texttt{flux} & \parbox{2cm}{\texttt{material}/\texttt{cell} \texttt{energy}} & \texttt{tracklength} \\

  \specialrule{.2em}{.1em}{.1em}

  \multirow{3}{*}[-1em]{\parbox{1.5cm}{\bf Transport-Corrected Total}} & \multirow{3}{*}[-1em]{$\hat{\tilde{\Sigma}}_{t,k,g}$} & $\langle \Sigma_{t}, \psi \rangle_{k,g}$ & \texttt{total} & \parbox{2cm}{\texttt{material}/\texttt{cell} \texttt{energy}} & \texttt{analog} \\
  \cline{3-6}
  & & $\langle \Sigma_{s1}, \psi \rangle_{k,g'\rightarrow g}$ & \texttt{nu-scatter-1} & \parbox{2cm}{\texttt{material}/\texttt{cell} \texttt{energyout}} & \texttt{analog} \\
  \cline{3-6}
  & & $\langle \psi \rangle_{k,g}$ & \texttt{flux} & \parbox{2cm}{ \texttt{material}/\texttt{cell} \texttt{energy}} & \texttt{analog} \\

  \specialrule{.2em}{.1em}{.1em}

  \multirow{2}{*}[-0.5em]{\parbox{1.5cm}{\bf Scattering Matrix}} & \multirow{2}{*}[-0.5em]{$\hat{\Sigma}_{s,k,g}$} & $\langle \Sigma_{s0}, \psi \rangle_{k,g'\rightarrow g}$ & \texttt{nu-scatter-0} & \parbox{2cm}{\texttt{material}/\texttt{cell} \texttt{energy} \texttt{energyout}} & \texttt{analog} \\
  \cline{3-6}
  & & $\langle \psi \rangle_{k,g}$ & \texttt{flux} & \parbox{2cm}{\texttt{material}/\texttt{cell} \texttt{energy}} & \texttt{analog} \\

  \specialrule{.2em}{.2em}{.2em}

  \multirow{3}{*}[-1em]{\parbox{1.5cm}{\bf Transport-Corrected Scattering Matrix}} & \multirow{3}{*}[-1em]{$\hat{\Sigma}_{s,k,g}$} & $\langle \Sigma_{s0}, \psi \rangle_{k,g'\rightarrow g}$ & \texttt{nu-scatter-0} & \parbox{2cm}{\texttt{material}/\texttt{cell} \texttt{energy} \texttt{energyout}} & \texttt{analog} \\
  \cline{3-6}
  & & $\langle \Sigma_{s1}, \psi \rangle_{k,g'\rightarrow g}$ & \texttt{nu-scatter-1} & \parbox{2cm}{\texttt{material}/\texttt{cell} \texttt{energyout}} & \texttt{analog} \\
  \cline{3-6}
  & & $\langle \psi \rangle_{k,g}$ & \texttt{flux} & \parbox{2cm}{\texttt{material}/\texttt{cell} \texttt{energy}} & \texttt{analog} \\

  \specialrule{.2em}{.1em}{.1em}

  \multirow{2}{*}[-0.5em]{\parbox{1.5cm}{\bf Fission \hspace{1cm} Production}} & \multirow{2}{*}[-0.5em]{$\hat{\nu\Sigma}_{f,k,g}$} & $\langle \nu\Sigma_{f}, \psi \rangle_{k,g}$ & \texttt{nu-fission} & \parbox{2cm}{\texttt{material}/\texttt{cell} \texttt{energy}} & \texttt{tracklength} \\
  \cline{3-6}
  & & $\langle \psi \rangle_{k,g}$ & \texttt{flux} & \parbox{2cm}{\texttt{material}/\texttt{cell} \texttt{energy}} & \texttt{tracklength} \\

  \specialrule{.2em}{.1em}{.1em}
  
  \parbox{1.5cm}{\bf Fission Spectrum} & $\hat{\chi}_{k,g}$ & $\langle \nu\Sigma_{f}, \psi \rangle_{k,g'\rightarrow g}$ & \texttt{nu-fission} & \parbox{2cm}{\texttt{material}/\texttt{cell} \texttt{energy} \texttt{energyout}} & \texttt{analog} \\
  \midrule

\end{tabular}
\end{table}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Uncertainty Propagation}
\label{subsec:chap3-uncertainty-prop}

\begin{itemize}[noitemsep]
  \item uncertainty propagation eqns
  \item need a reference
  \item https://en.wikipedia.org/wiki/Propagation_of_uncertainty
\end{itemize}

define covariance\\
two random variables $X$ and $Y$ with standard deviations $\sigma_{X}$ and $\sigma_{Y}$\\

\begin{equation}
Z = aX \qquad,\qquad \sigma_{Z}^{2} = a^{2}\sigma_{X}^{2}
\end{equation}

\begin{equation}
Z = X + Y \qquad,\qquad \sigma_{Z}^{2} = \sigma_{X}^{2} + \sigma_{Y}^{2} + 2\sigma_{XY}
\end{equation}

\begin{equation}
Z = X - Y \qquad,\qquad \sigma_{Z}^{2} = \sigma_{X}^{2} + \sigma_{Y}^{2} - 2\sigma_{XY}
\end{equation}

\begin{equation}
Z = XY \qquad,\qquad \sigma_{Z}^{2} \approx Z^{2}\left[\left(\frac{\sigma_{X}}{X}\right)^{2} + \left(\frac{\sigma_{Y}}{Y}\right)^{2} + 2\frac{\sigma_{XY}}{Z}\right] \approx Z^{2}\left[\left(\frac{\sigma_{X}}{X}\right)^{2} + \left(\frac{\sigma_{Y}}{Y}\right)^{2}\right]
\end{equation}

\begin{equation}
Z = \frac{X}{Y} \qquad,\qquad \sigma_{Z}^{2} \approx Z^{2}\left[\left(\frac{\sigma_{X}}{X}\right)^{2} + \left(\frac{\sigma_{Y}}{Y}\right)^{2} - 2\frac{\sigma_{XY}}{Z}\right] \approx Z^{2}\left[\left(\frac{\sigma_{X}}{X}\right)^{2} + \left(\frac{\sigma_{Y}}{Y}\right)^{2}\right]
\end{equation}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Review of Previous Efforts}
\label{sec:chap3-lit-review}

\begin{itemize}[noitemsep]
  \item \ac{MGXS} for coarse mesh diffusion
  \begin{itemize}[noitemsep]
    \item Serpent
    \item Redmond
    \item Pounders
  \end{itemize}
  \item \ac{MGXS} for fine mesh transport
  \begin{itemize}[noitemsep]
    \item Nelson with NDPP
  \end{itemize}
\end{itemize}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{A New Approach: A Latent Variable Model}
\label{sec:chap3-latent-variables}

\begin{itemize}[noitemsep]
  \item tally ``noise'' model
  \item spatial self-shielding treatment is natural in \ac{MC}
  \item challenge is slow convergence rate
  \item motivate clustering
\end{itemize}