\chapter{Multi-Group Transport Theory}
\label{chap:mgxs}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Background}
\label{sec:chap2-background}

The field of reactor physics is concerned with computing the distribution of nuclear reaction rates throughout a nuclear reactor core. Nuclear reaction rates are dependent on two fundamental quantities: the density of neutrons and the probability of interaction. The angular neutron flux $\psi(\mathbf{r},\mathbf{\Omega},E)$ models the neutron density\footnote{Unlike the common definition of flux used in other areas of science and engineering, the angular flux $\psi$ is the product of the volume density and speed of neutrons in phase space.} and is dependent on a neutron's spatial position $\mathbf{r}$, direction of motion $\mathbf{\Omega}$ and energy $E$\footnote{This thesis focuses on steady-state calculations and the time dependence of the flux is neglected here for simplicity.}$^{,}$\footnote{Vector-valued quantities are expressed in boldface font.}. The macroscopic cross section $\Sigma_{x}(\mathbf{r},E)$ is defined as the probability of interaction $x$ per unit of length travelled by a neutron at some position and energy. A reaction rate $\mathcal{R}_{x}$ can be simply computed as the product of the angular flux and cross section:

\begin{equation}
\label{eqn:chap2-rxn-rates}
\mathcal{R}_{x}(\mathbf{r},\mathbf{\Omega},E) = \Sigma_{x}(\mathbf{r},E) \psi(\mathbf{r},\mathbf{\Omega},E)
\end{equation}

%-integrate out angle, introduce scalar flux\\

The macroscopic cross section $\Sigma$ is proportional to a quantity known as the microscopic cross section $\sigma_{x}$. The microscopic cross section is a property of a particular nuclide, and is measured experimentally for various reaction types which include fission $f$, radiative capture $\gamma$ and scattering $s$\footnote{Scattering as defined here includes both inelastic and elastic scattering.}. The macroscopic cross section is then the sum of the microscopic cross sections of each nuclide $i$ weighted by its number density $N_{i}$:

\begin{equation}
\label{eqn:chap2-macro-xs-sum}
\Sigma_{x} = \sum_{i}N_{i}\sigma_{i,x}
\end{equation}

The microscopic cross section is highly dependent on the energy of the incoming neutron. As illustrated in see Figure~\ref{fig:chap2-u238-xs}, a cross section may vary several orders of magnitude near resonances which may span only a few eV. The distribution of neutrons in \ac{LWRs} spans 11 orders of magnitude from a few MeV at birth from fission emission to death through absorption at energies as low as 10$^{-5}$ eV. The accurate determination of the reaction rate distribution is primarily challenged by the complicated energy structure of cross sections coupled with the wide energy range of neutrons in a system.

\begin{figure}[H]
  \centering
  \includegraphics[width=0.8\linewidth]{figures/mgxs/u238-capture-xs}
\caption[U-238 capture cross section]{The continuous energy capture cross section for U-238.}
\label{fig:chap2-u238-xs}
\end{figure}
 
The probability of some interactions may also depend on other properties which characterize the output channel of the reaction. For example, the scattering cross section $\sigma_{s}$ depends on the energy and direction of motion of the outgoing neutron. The fission cross section $\sigma_{f}$ also depends on the energy of the emitted neutron(s) but the outgoing angular distribution is typically treated as isotropic. The macroscopic cross section varies in space if the nuclide number densities depend on the position $\mathbf{r}$ within a heterogeneous system.

Although cross sections are experimentally measured, the neutron flux must be calculated analytically or with simulation. The steady-state continuous energy transport equation is integro-differential in the neutron angular flux $\psi(\mathbf{r},\mathbf{\Omega},E)$ and balances the rate of change of the population of neutrons to the difference between the production and loss rates of neutrons within a closed system:

\begin{dmath}
\label{eqn:chap1-eqn1}
\mathbf{\Omega} \cdot \nabla \psi(\mathbf{r},\mathbf{\Omega},E) + \Sigma_{t}(\mathbf{r},E)\psi(\mathbf{r},\mathbf{\Omega},E) = \;\;\; \int_{0}^{\infty}\int_{4\pi} \Sigma_{s}(\mathbf{r},{\mathbf{\Omega'}\rightarrow\mathbf{\Omega}},{E'\rightarrow E}) \psi(\mathbf{r},\mathbf{\Omega'},E') \mathrm{d}\mathbf{\Omega'} \mathrm{d}E' + Q(\mathbf{r},\mathbf{\Omega},E)
\end{dmath}

The first term on the left hand side of the equation represents the streaming of neutrons within space and the second term is the total neutron collision rate determined by the total cross section $\Sigma_{t}$. On the right hand side, the first term models the scattering of neutrons at energy $E'$ and direction $\mathbf{\Omega'}$ into some new energy $E$ and direction $\mathbf{\Omega}$. The final term represents a generic source $Q$ of neutrons. In the case of critical systems, such as nuclear reactors, $Q$ is a source of fission neutrons:

\begin{dmath}
\label{eqn:chap1-source}
Q(\mathbf{r},\mathbf{\Omega},E) = \frac{1}{4\pi k_{eff}}\int_{0}^{\infty}\int_{4\pi} \nu\Sigma_{f}(\mathbf{r},{E'\rightarrow E})\psi(\mathbf{r},\mathbf{\Omega'},E') \mathrm{d}\mathbf{\Omega'} \mathrm{d}E'
\end{dmath}

A solution for the neutron flux must computed from the transport equation. The complicated energy dependence of the cross sections precludes an analytical solution to Equation~\ref{eqn:chap1-eqn1} without significant simplifying assumptions. Instead, numerical simulation is used to solve the transport equation for the flux. Although the spatial and angular variables using standard discretization techniques for PDEs, the energy variable presents its own complications. Monte Carlo techniques may be employed to exactly treat the energy dependence in Equation~\ref{eqn:chap1-eqn1}\footnote{The treatment is only as exact as the measured nuclear cross section data will permit.}, but are computationally burdensome and not yet practical for routine nuclear reactor analysis.

The following section describes the approximations used to derive the multi-group form. 

-talk about how it is tough to solve equation numerically due to energy dependence; other variables can be treated numerically using standard techniques for PDEs\\
-need to define keff \\
-need to define nu\\

-discuss each approximation in sequence, building approximations upon one another similar to \ac{MOC} derivation in M.S. thesis??

\begin{itemize}[noitemsep]
  \item continuous energy neutron transport equation
  \item \ac{MGXS} equations
  \begin{itemize}[noitemsep]
    \item generic reaction
    \item scattering matrix
    \item chi fission spectrum
  \end{itemize}
  \item equation and figures mapped to variables
  \item tally ``noise'' model
  \item uncertainty propagation equations
  \item mention that this intro is agnostic to the method used to solve the transport eqn.
   \item define subscripts for $\Sigma$ and $R$ - $a$, $f$, $\gamma$, $t$, $s$
   \item define neutron transport equation with generic source $Q$
   \item then define source specifically for criticality problem
   \item energy indices are defined in order for decreasing energy
   \item in constant-in-angle section, mention Nate Eqn. 1.13 as one possible approach for deterministic methods for the collapse. In MC we use the angular flux in the collapse though.
   \item cite boltzmann transport equation (see adam's thesis pg. 1) 
   \item tie back to experimental data and its uncertainties - MC is only as accurate as measured reaction data (maybe in the intro chap. 1)
   \item mention recent work to use MC for MGXS (chap. 3 of nelson's thesis)
   \item define angular flux - neutron angular density multiplied by neutron speed
   \item phase space defn from adam's thesis pg 5 - as tot dist traveled
   \item talk about (n,xn) reactions
   \item keep fission as matrix early on
   \item figure 2.2 from adam's thesis to describe typical approach
\end{itemize}


%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Approximations}
\label{subsec:chap2-approx}

\begin{itemize}
  \item motivate bias studies in chapter 4
\end{itemize}

Equation~\ref{eqn:chap1-transport-eqn-src} is defined with $\Psi$, $Q$ and $\Sigma^T$ as continuous functions of energy. The first approximation to numerically solve this equation is to discretize the energy domain into distinct \textit{energy groups} $g \in G = \{1, 2, ..., G\}$ where group $g$ spans the continuous range of energies from $E_{g}$ to $E_{g-1}$. This is otherwise known as the \textit{multi-group approximation}. The multi-group form of the Boltzmann equation is presented below:

\begin{equation}
\label{eqn:chap2-transport-eqn-mg}
\mathbf{\Omega} \cdot \nabla \Psi_g(\mathbf{r},\mathbf{\mathbf{\Omega}}) + \Sigma^T_{g}(\mathbf{r})\Psi_g(s,\mathbf{\Omega}) = Q_g(\mathbf{r},\mathbf{\Omega})
\end{equation}

Likewise, the multi-group form of the neutron source (Equation~\ref{eqn:chap1-source}) is given by:

\begin{dmath}
\label{eqn:chap2-source-mg}
Q_g(\mathbf{r},\mathbf{\Omega}) = \displaystyle\sum\limits_{g'=1}^G \int_{4\pi} \mathrm{d}\mathbf{\Omega'}\Sigma_{g'\rightarrow g}^S(\mathbf{r},{\mathbf{\Omega'}\rightarrow\mathbf{\Omega}}) \Psi_{g'}(\mathbf{r},\mathbf{\Omega'}) + \\ \frac{\chi_{g}(\mathbf{r})}{4\pi k_{eff}} \displaystyle\sum\limits_{g'=1}^G \nu\Sigma_{g'}^F(\mathbf{r}) \int_{4\pi} \mathrm{d}\mathbf{\Omega'} \Psi_{g'}(\mathbf{r},\mathbf{\Omega'})
\end{dmath}

\begin{equation}
\label{eqn:moc-theory-condensed-total-xs}
\Sigma_{g}^T(\mathbf{r}) = \frac{\int_{E_{g}}^{E_{g-1}}\mathrm{d}E'\Sigma^T(\mathbf{r},E')\Psi(\mathbf{r},\mathbf{\Omega},E')}{\int_{E_{g}}^{E_{g-1}}\mathrm{d}E'\Psi(\mathbf{r},\mathbf{\Omega},E')}
\end{equation}

\begin{equation}
\label{eqn:moc-theory-condensed-fission-xs}
\Sigma_{g}^F(\mathbf{r}) = \frac{\int_{E_{g}}^{E_{g-1}}\mathrm{d}E'\Sigma^F(\mathbf{r},E')\Psi(\mathbf{r},\mathbf{\Omega},E')}{\int_{E_{g}}^{E_{g-}1}\mathrm{d}E'\Psi(\mathbf{r},\mathbf{\Omega},E')}
\end{equation}

\begin{equation}
\label{eqn:moc-theory-condensed-scatter-xs}
\Sigma_{g'\rightarrow g}^S(\mathbf{r},\mathbf{\Omega'}\rightarrow \mathbf{\Omega}) = \frac{\int_{E_{g'}}^{E_{g'-1}}\mathrm{d}E'\int_{E_{g}}^{E_{g-1}}\mathrm{d}E''\Sigma^S(\mathbf{r},\mathbf{\Omega'}\rightarrow \mathbf{\Omega},E'\rightarrow E'')\Psi(\mathbf{r},\mathbf{\Omega'},E')}{\int_{E_{g'}}^{E_{g'-1}}\mathrm{d}E'\Psi(\mathbf{r},\mathbf{\Omega'},E')}
\end{equation}

\begin{equation}
\label{eqn:moc-theory-condensed-chi}
\chi_{g'\rightarrow g}(\mathbf{r}) = \frac{\int_{E_{g'}}^{E_{g'-1}}\mathrm{d}E'\int_{E_{g}}^{E_{g-1}}\mathrm{d}E''\chi(\mathbf{r},E'\rightarrow E'')\nu\Sigma^F(\mathbf{r},\mathbf{\Omega},E')\Psi(\mathbf{r},\mathbf{\Omega'},E')}{\int_{E_{g'}}^{E_{g'-1}}\mathrm{d}E'\nu\Sigma^F(\mathbf{r},\mathbf{\Omega},E')\Psi(\mathbf{r},\mathbf{\Omega'},E')}
\end{equation}

Although \autoref{eqn:moc-theory-condensed-chi} assumes a dependence of $\chi$ on both the energy of the neutron causing fission $g'$ and the fission emission energy group $g$, the former is typically summed over to simplify the multi-group $\chi$ to the following approximation:

\begin{equation}
\label{eqn:moc-theory-condensed-chi-group}
\chi_{g}(\mathbf{r}) = \displaystyle\sum\limits_{g=1}^{G}\chi_{g'\rightarrow g}(\mathbf{r})
\end{equation}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Energy Discretization}
\label{subsubsec:chap2-energy-discrete}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Spatial Discretization}
\label{subsubsec:chap2-space-discrete}

In addition to the flat source approximation, it is assumed that the material properties are constant across each FSR. The area-averaged cross sections for FSR $i \in \{1, 2, ..., I\}$ with area $A_{i}$ are defined as:

\begin{equation}
\label{eqn:chap2-area-avg-total-xs}
\Sigma_{i,g}^{T} = \frac{\int_{\mathbf{r}\in A_{i}}\mathrm{d}\mathbf{r}\Sigma_{g}^T(\mathbf{r})\Phi_{g}(\mathbf{r})}{\int_{\mathbf{r}\in A_{i}}\mathrm{d}\mathbf{r}\Phi_{g}(\mathbf{r})}
\end{equation}

\begin{equation}
\label{eqn:chap2-area-avg-fission-xs}
\Sigma_{i,g}^{F} = \frac{\int_{\mathbf{r}\in A_{i}}\mathrm{d}\mathbf{r}\Sigma_{g}^F(\mathbf{r})\Phi_{g}(\mathbf{r})}{\int_{\mathbf{r}\in A_{i}}\mathrm{d}\mathbf{r}\Phi_{g}(\mathbf{r})}
\end{equation}

\begin{equation}
\label{eqn:chap2-area-avg-scatter-xs}
\Sigma_{i,g'\rightarrow g}^{S} = \frac{\int_{\mathbf{r}\in A_{i}}\mathrm{d}\mathbf{r}\Sigma_{g'\rightarrow g}^S(\mathbf{r})\Phi_{g'}(\mathbf{r})}{\int_{\mathbf{r}\in A_{i}}\mathrm{d}\mathbf{r}\Phi_{g'}(\mathbf{r})}
\end{equation}

\begin{equation}
\label{eqn:chap2-area-avg-chi}
\chi_{i,g} = \frac{\int_{\mathbf{r}\in A_{i}}\mathrm{d}\mathbf{r}\chi_{g}(\mathbf{r})}{\int_{\mathbf{r}\in A_{i}}\mathrm{d}\mathbf{r}}
\end{equation}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Isotropic Scattering}
\label{subsubsec:chap2-iso-scatter}

\begin{itemize}
  \item mention ``iso-in-lab'' feature in OpenMC
\end{itemize}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Scalar Flux Weighting}
\label{subsubsec:chap2-const-in-angle}

\begin{itemize}[noitemsep]
  \item connect to Nate's ``batman'' plot
\end{itemize}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{MGXS Generation with Monte Carlo}
\label{sec:chap2-mgxs-mc}

\begin{itemize}[noitemsep]
  \item \ac{MC} is \emph{reactor agnostic}
  \item stochastic approx. to integrals in Section~\ref{sec:chap2-background}
\end{itemize}

%%%%%%%%%%%%%%%%%%%%%%
\subsection{Past Work}
\label{subsec:chap2-past-work}

\begin{itemize}[noitemsep]
  \item \ac{MGXS} for coarse mesh diffusion
  \begin{itemize}[noitemsep]
    \item Redmond
    \item Pounders
    \item Serpent
  \end{itemize}
  \item \ac{MGXS} for fine mesh transport
  \begin{itemize}[noitemsep]
    \item Nelson with NDPP
  \end{itemize}
\end{itemize}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Spatial Self-Shielding Treatment}
\label{subsec:chap2-spatial-shield}

\begin{itemize}[noitemsep]
  \item spatial self-shielding treatment is natural in \ac{MC}
  \item challenge is slow convergence rate
  \item motivate clustering
\end{itemize}